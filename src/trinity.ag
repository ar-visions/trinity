<<<<<<< HEAD

# all imports will end up being reflected as headers
import A
import gltf
import img

import <vulkan/vulkan.h> [ https://github.com/KhronosGroup/Vulkan-Headers ]
import [ https://github.com/KhronosGroup/Vulkan-Tools ]
     -DVULKAN_HEADERS_INSTALL_DIR={silver_install}

alias skia_t   : ref void
alias handle_t : ref void

func skia_init_vk[ trinity t, handle_t vk_instance, handle_t vma_allocator, handle_t phys, handle_t device, 
    handle_t queue, unsigned int graphics_family, unsigned int vk_version ] -> skia_t

import chatgpt
    model:'gpt-5'

class trinity
    intern      instance            : VkInstance               
    intern      msaa_samples        : i64                      
    intern      physical_device     : VkPhysicalDevice         
    intern      device              : VkDevice                 
    intern      queue               : VkQueue                  
    intern      debug               : VkDebugUtilsMessengerEXT 
    intern      command_pool        : VkCommandPool            
    intern      allocator           : VmaAllocator                               
    intern      device_memory       : map                      
    public      queue_family_index  : i32 -1 
    public      rt_support          : bool                     
    public      instance_exts       : array [ alloc:128, unmanaged:true ]
    public      device_exts         : array [ alloc:128, unmanaged:true ]
    public   func texture             [ environment image vec3f f32 ]
    func init                [ ]
        verify glfwInit(), "glfw init"

        wsize2 : sizeof(struct _window);
        bsize2 : sizeof(struct _Basic);

        // this takes 4-5 seconds, and its not needed
        #ifndef NDEBUG
        if (!glfwVulkanSupported()) {
            fault("glfw does not support vulkan");
            glfwTerminate();
            return;
        }
        #endif

        instance = vk_create[ t ]
        verify instance, "vk instance failure"

        // enumerate physical devices (adapter in WebGPU)
        deviceCount : u32 0
        vkEnumeratePhysicalDevices[ instance, deviceCount, null ]
        verify deviceCount > 0, "failed to find GPUs with Vulkan support"

        physical_devices : new VkPhysicalDevice[ deviceCount ]
        vkEnumeratePhysicalDevices[ instance, ref deviceCount, physical_devices ]
        t->physical_device = physical_devices[0] // Choose the first device or implement selection logic

        // Check for device extensions
        extension_count : u32 0
        vkEnumerateDeviceExtensionProperties t->physical_device, null, ref extension_count, null
        verify extension_count > 0, "failed to find device extensions"

        extensions : new VkExtensionProperties[ extension_count ]

        vkEnumerateDeviceExtensionProperties
            physical_device
            null
            ref extension_count
            extensions
        
        # Check for required extensions
        swapchain_supported : false

        device_extensions: stack symbol[]
            VK_KHR_SWAPCHAIN_EXTENSION_NAME
            # "VK_KHR_sampler_cubic"
        
        total_extension_count : sizeof device_extensions / sizeof device_extensions[0]
        
        # Track which RT extensions are found
        found_extensions: stack bool[total_extension_count]
        # redundant
        #memset(found_extensions, 0, sizeof(found_extensions));
        
        # check which extensions are available
        pr : getenv[ "VERBOSE" ] != null

        for [ i: 0, i < extension_count, i++ ]
            push device_exts, strdup[ extensions[i].extensionName ]
            if [ pr ]
                puts "[supported] device extension: %s", extensions[i].extensionName

            if [ extensions[i].extensionName == VK_KHR_SWAPCHAIN_EXTENSION_NAME ]
                swapchain_supported = true
            
            for [ j = 0; j < total_extension_count; j++ ]
                if [ extensions[i].extensionName == device_extensions[j] ]
                    found_extensions[j] = true;
                    break

        for [ j : 0, j < total_extension_count, j++ ]
            verify found_extensions[j], "extension not found: %s", device_extensions[j]

        verify swapchain_supported, "VK_KHR_swapchain extension is not supported by the physical device"
        
        bufferDeviceAddressFeatures: VkPhysicalDeviceBufferDeviceAddressFeatures
            sType: VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_BUFFER_DEVICE_ADDRESS_FEATURES
            bufferDeviceAddress: VK_TRUE

        features2: VkPhysicalDeviceFeatures2
            sType: VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_FEATURES_2
            pNext: ref bufferDeviceAddressFeatures

        # t->msaa_samples = max_sample_count(t->physical_device);
        vkGetPhysicalDeviceFeatures2[ physical_device, ref features2 ] # Fetch the features from the physical device

        // Prepare device extensions
        queuePriority: float 1.0f
        verify vkCreateDevice[ t->physical_device, &(VkDeviceCreateInfo ]
        [
            [
                sType                      : VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO
                pNext                      : ref features2
                queueCreateInfoCount       : 1
                pQueueCreateInfos          : [
                    sType                  : VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO
                    queueFamilyIndex       : 0 # Replace with actual graphics queue family index
                    queueCount             : 1
                    pQueuePriorities       : ref queuePriority
                ]
                enabledExtensionCount      : 1
                ppEnabledExtensionNames    : device_extensions

            ], null, ref device
        ] == VK_SUCCESS, "cannot create logical device"

        verify vmaCreateAllocator[
            [
                physicalDevice   : physical_device
                device           : device
                instance         : instance
                vulkanApiVersion : vk_version
                pVulkanFunctions : NULL
                flags            : VMA_ALLOCATOR_CREATE_BUFFER_DEVICE_ADDRESS_BIT
            
            ], ref allocator
        
        ] == VK_SUCCESS, "cannot create vma allocator"

    func dealloc [ ]
    func a-method-dictated[] using chatgpt 
=======
import gltf
import img
import KhronosGroup:Vulkan-Headers <vulkan/vulkan.h>
import KhronosGroup:Vulkan-Tools
    -DVULKAN_HEADERS_INSTALL_DIR={install}

alias skia_t   : handle
alias handle_t : handle

skia_t skia_init_vk[trinity t, handle_t vk_instance, handle_t vma_allocator, handle_t phys, handle_t device, 
    handle_t queue, unsigned int graphics_family, unsigned int vk_version]

class trinity
    intern VkInstance               instance
    intern i64                      msaa_samples
    intern VkPhysicalDevice         physical_device
    intern VkDevice                 device
    intern VkQueue                  queue
    intern VkDebugUtilsMessengerEXT debug
    intern VkCommandPool            command_pool
    intern VmaAllocator             allocator
    intern map                      device_memory
    i32                             queue_family_index
    bool                            rt_support
    array                           instance_exts
    array                           device_exts
    texture                         [image environment, vec3f, f32]
    none init[]
    none dealloc[]
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6

# ---------------------------
# we support structs
# ---------------------------
struct mouse_state
<<<<<<< HEAD
    wheel_delta : vec2f       
    pos         : vec2f       
    button      : i32         
    state       : i32         

struct keyboard_state
    unicode   : u32     
    scan_code : u32          
    state     : i32      
    meta      : bool     
    shift     : bool         
    alt       : bool     
    text      : string
=======
    vec2f wheel_delta
    vec2f pos
    i32   button
    i32   state

struct keyboard_state
    u32    unicode
    u32    scan_code
    i32    state
    bool   meta
    bool   shift
    bool   alt
    string text
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6


# we need to support forward declarations, the same way we do with our resolver
# so this means we must process these the same way, with an different method for generation (make_class -> make_decl)
class event
<<<<<<< HEAD
    public  target           : element        
    public  mouse            : mouse_state    
    public  key              : keyboard_state 
    public  prevent_default  : bool           
    public  stop_propagation : bool           
    public  func prevent_default  [ ] -> none [ ]      
    public  func is_default       [ ] -> bool       
    public  func should_propagate [ ] -> bool       
    public  func stop_propagation [ ] -> bool       
    public  func clear            [ ] -> none
=======
    element        target
    mouse_state    mouse
    keyboard_state key
    bool           prevent_default
    bool           stop_propagation
    none prevent_default[]
    bool is_default[]
    bool should_propagate[]
    bool stop_propagation[]
    none clear[]
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6

# enums can be exported to our A-type 
enum Ease
    linear  : 0
    quad    : 1
    cubic   : 2
    quart   : 3
    quint   : 4
    sine    : 5
    expo    : 6
    circ    : 7
    back    : 8
    elastic : 9
    bounce  : 10

enum Direction
    in      : 0
    out     : 1
    in_out  : 2

class line_info
<<<<<<< HEAD
    intern data            :  string                      
    intern len             :  num                        
    intern adv             :  array f64[]                       
    intern bounds          :  rect                       
    intern placement       :  rect                       

class text_sel
    public column : num   
    public row    : num   

class text
    public lines   : array line_info     
    public replace : text          


class style      
    public  css_path  : path    
    public  members   : map        
    public  reloader  : watch    
    public  base      : array style_block   
    intern  mtx       : mutex    
    intern  mod_time  : i64        
    intern  reloaded  : bool       
    intern  loaded    : bool 

    public func applicable [ element string array ] -> bool
    public func process    [ string ] -> none 

    public func cache_members [ ] -> none
    public func best_match    [ element string array ] -> style_entry
    public func compute       [ element ] -> map
    public func check_reload  [ ] -> bool
    public ctr [ path ]
    public ctr [ object ]

class style_block
    public parent : style_block
    public quals : array
    public entries : map
    public blocks : array
    public types : array
    public func score [ element  bool ] -> f32
    func init [ ]
=======
    intern string      data
    intern num         len
    intern f64[...]    adv
    intern rect        bounds
    intern rect        placement

class text_sel
    num column
    num row

class text
    line_info[...]  lines
    text            replace


class style
    path              css_path
    map               members
    watch             reloader
    array style_block base
    intern mutex      mtx
    intern i64        mod_time
    intern bool       reloaded
    intern bool       loaded

    bool applicable[element, string, array]
    none process[string]

    none cache_members[]
    style_entry best_match[element, string, array]
    map compute[element]
    bool check_reload[]
    construct [path]
    construct [object]

class style_block
    style_block       parent
    array             quals
    map               entries
    array             blocks
    array             types
    f32 score[element, bool]
    none init[]
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6

enum Duration
    ms : 2
    ns : 1
    s  : 3

enum xalign : f32
    undefined : 0
    left      : 0.0
    middle    : 0.5
    right     : 1.0
    width     : 2.0

enum yalign : f32
    undefined : 0
    top       : 0.0
    middle    : 0.5
    bottom    : 1.0
    height    : 2.0

struct xcoord
<<<<<<< HEAD
    public x_type   : xalign   
    public offset   : f32      
    public relative : bool     
    public percent  : bool     
    public ctr [ string ]

struct ycoord
    public y_type   : yalign         
    public offset   : f32            
    public relative : bool           
    public percent  : bool           
    public ctr [ string ]

class region
    public l : xcoord
    public t : ycoord
    public r : xcoord
    public b : ycoord
    public set : bool
    public ctr [ rect ]
    public ctr [ f32 ]
    public ctr [ string ]
    public func rectangle [ rect  rect ] -> rect
    public func mix [ region  f32 ] -> region

class rotation
    public axis : vec3f
    public degs : f32
    public ctr [ vec4f  ]
    public ctr [ string ]
    public func mix [ rotation  f32 ] -> rotation

class translation
    public value : vec3f
    public ctr [ vec3f ]
    public ctr [ string ]
    public func mix [ translation  f32 ] -> translation
declare_class(translation)

class scaling
    public value : vec3f
    public ctr [ vec3f ]
    public ctr [ string ]
    public func mix [ scaling  f32 ] -> scaling
declare_class(scaling)

# unit tcoord [ Duration ]

class style_transition
    public easing : Ease
    public dir : Direction
    public duration : tcoord
    intern from : object
    intern to : object
    intern start : i64
    intern invalidate : bool
    intern reference : style_transition
    intern is_inlay : bool
    intern type : Au_t
    intern location : ref object
    public ctr [ string ]
    public func pos [ f64 ] -> f64
=======
    xalign x_type
    f32    offset
    bool   relative
    bool   percent
    construct [string]

struct ycoord
    yalign y_type
    f32    offset
    bool   relative
    bool   percent
    construct [string]

class region
    xcoord l
    ycoord t
    xcoord r
    ycoord b
    bool set
    construct [rect]
    construct [f32]
    construct [string]
    rect   rectangle[rect, rect]
    region mix[region, f32]

class rotation
    vec3f axis
    f32   degs
    construct [vec4f]
    construct [string]
    rotation mix[rotation, f32]

class translation
    vec3f value
    construct [vec3f]
    construct [string]
    translation mix[translation, f32]


class scaling
    vec3f value
    construct [vec3f]
    construct [string]
    scaling mix[scaling, f32]


# unit tcoord [ Duration ]
class style_transition
    Ease             easing
    Direction        dir
    tcoord           duration
    intern object    from
    intern object    to
    intern i64       start
    intern bool      invalidate
    intern style_transition reference
    intern bool      is_inlay
    intern Au_t      type
    intern ref object location
    construct [string]
    f64 pos[f64]
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6
    cast bool


class style_entry
<<<<<<< HEAD
    public member : string
    public value : string
    public trans : style_transition
    public bl : style_block
    public instance : object


class style_qualifier
    intern ty       : Au_t
    public type     : string
    public id       : string
    public state    : string
    public oper     : string
    public value    : string
    public parent   : object


class style_selection
    public from : handle
    public to : handle
    public start : i64
    public end : i64
    public entry : style_entry


class composer
    public app                  : object
    public w                    : window
    intern root_styles          : map
    public root                 : element
    public capture              : element
    public focus                : element
    public hovered              : element
    public action_pressed       : element
    public context_pressed      : element
    public args                 : map
    public restyle              : bool
    public style                : style
    public mouse                : vec2f
    public buttons              : array[i32 16x1]
    public shift                : bool
    public alt                  : bool
    public on_render            : hook
    public apply_args           [ element element ]   -> array
    public apply_style          [ element map array ] -> array
    public func animate           [ ]
    public func bind_subs         [ element element ]
    public func update            [ element map ]
    public func update_all        [ map ]
    public func invalidate        [ ]
    public func remove_invalid    [ ]
    public func set_capture       [ element ]
    public func release_capture   [ element ]
    public func set_focus         [ element ]
    public func release_focus     [ element ]
    public func find_target       [ element, event, element ] -> element
    public func text_event        [ event ]
    public func move_event        [ event ]
    public func key_event         [ event ]
    public func wheel_event       [ event ]
    public func press_event       [ event ]
    public func release_event     [ event ]
=======
    string           member
    string           value
    style_transition trans
    style_block      bl
    object           instance


class style_qualifier
    intern Au_t      ty
    string           type
    string           id
    string           state
    string           oper
    string           value
    object           parent


class style_selection
    handle      from
    handle      to
    i64         start
    i64         end
    style_entry entry


class composer
    object         app
    window         w
    intern map     root_styles
    element        root
    element        capture
    element        focus
    element        hovered
    element        action_pressed
    element        context_pressed
    map            args
    bool           restyle
    style          style
    vec2f          mouse
    i32[16x1]      buttons
    bool           shift
    bool           alt
    hook           on_render
    array apply_args[element, element]
    array apply_style[element, map, array]
    none animate[]
    none bind_subs[element, element]
    none update[element, map]
    none update_all[map]
    none invalidate[]
    none remove_invalid[]
    none set_capture[element]
    none release_capture[element]
    none set_focus[element]
    none release_focus[element]
    element find_target[element, event, element]
    none text_event[event]
    none move_event[event]
    none key_event[event]
    none wheel_event[event]
    none press_event[event]
    none release_event[event]
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6

// holds onto arg state; its useful to have to facilitate
// effective config from user (not including style!)
// also inline data such as structs may hold their data here
class arg
<<<<<<< HEAD
    public name     : string
    public value    : object
    public offset   : i32
    public is_inlay : bool


enum Fill : f32
    none      : 0.00f
    blur      : 0.50f
    frost     : 1.00

enum Canvas
    overlay     : 0
    compose     : 1
    colorize    : 2
    glyph       : 3

enum Pattern
    none : 0
    repeat_x : 1
    repeat_y : 2
    repeat_xy : 3

enum Clip
    none : 0
    clip : 1
=======
    string name
    object value
    i32    offset
    bool   is_inlay


enum Fill : f32
    none    : 0.00f
    blur    : 0.50f
    frost   : 1.00

enum Canvas
    overlay  : 0
    compose  : 1
    colorize : 2
    glyph    : 3

enum Pattern
    none      : 0
    repeat_x  : 1
    repeat_y  : 2
    repeat_xy : 3

enum Clip
    none     : 0
    clip     : 1
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6
    ellipsis : 2


class mixable
<<<<<<< HEAD
    public ctr [ string ]
    public func mix [ mixable  f32 ] -> mixable

mixable shadow
    public blur : f32
    public color : rgba
    public offset : vec2f

mixable glow
    public blur : f32
    public color : rgba

// zero reason to apply to general elements; only for background
// we will never rotate text ROTEXT.VBX is for noob saibots
mixable transform
    public offset   : vec2f
    public scale    : vec2f
    public rotation : f32

class background
    public image        : image
    public transform    : transform
    public repeat       : Pattern
    public ctr [ string ]
    public func mix [ background  f32 ] -> background

array radius [ f32 ]

// for all layers, we will construct with field inference
// that means the constructors need only be Type [ any str ]
class layer
    public canvas : Canvas
    public area : region
    public radius : radius
    public shadow : shadow
    public color : rgba
    public background : background
    public overflow : Clip
    public opacity : f32
    public ctr [ string ]
    public func mix [ layer  f32 ] -> layer


layer text
    public font : font
    public xalign : xalign
    public yalign : yalign
    public label : string


// all can be set by value except miter, the 2nd f32 which we specify miter:v
layer border
    public size     : f32
    public cap      : cap
    public join     : join
    public miter    : f32
    public dash     : array f32

layer fill

// cant inherently scroll in any element that doesnt have a defined children region
layer children
    public scroll : vec2f

class element
    public parent : element
    public area : region
    public value : object
    public id : string
    public flags : i64
    public layers : array layer
    public elements : map
    public tags : array
    public group : string
    public tab_index : i32
    public ghost : bool
    public captured : bool
    public selectable : bool
    public selected : bool
    public disabled : bool
    public hovered : bool
    public pressed : bool
    public focused : bool
    public action : subs
    public wheel : subs
    public context : subs
    public text : subs
    public hover : subs
    public leave : subs
    public key_down : subs
    public key_up : subs
    public press : subs
    public move : subs
    public release : subs
    public got_capture : subs
    public lost_capture : subs
    public focus : subs
    public blur : subs
    public cursor : vec2f
    intern ux : composer
    intern style_avail : map
    intern selections : map
    intern transitions : map
    intern restyle : bool
    public func set_capture [ ] -> none
    public func release_capture [ ] -> none
    public func set_focus [ ] -> none
    public func release_focus [ ] -> none
    public func draw [ window ] -> none
    public func render [ array ] -> map
    func compare [ element ]

element scene
    public target : target
    public models : array
    public render_scale : f32
    public clear_color : vec4f
    public rotate    : array rotation
    public translate : array translation
    public scale     : array scaling
    public update : subs
    func draw[ window ]
    func init    [ ]
    func dealloc [ ]

scene stage
    public frost : bool
    func init [ ]
    func dealloc [ ]
=======
    construct [string]
    mixable mix[mixable, f32]

class shadow of mixable 
    f32  blur
    rgba color
    vec2f offset

class glow of mixable
    f32  blur
    rgba color

// zero reason to apply to general elements; only for background
// we will never rotate text ROTEXT.VBX is for noob saibots
class transform of mixable
    vec2f offset
    vec2f scale
    f32   rotation

class background
    image     image
    transform transform
    Pattern   repeat
    construct [string]
    background mix[background, f32]

# for all layers, we will construct with field inference
# that means the constructors need only be Type [ any str ]
class layer
    Canvas     canvas
    region     area
    radius     radius
    shadow     shadow
    rgba       color
    background background
    Clip       overflow
    f32        opacity
    construct [string]
    layer mix[layer, f32]


class text of layer
    font   font
    xalign xalign
    yalign yalign
    string label


# all can be set by value except miter, the 2nd f32 which we specify miter:v
class border of layer
    f32       size
    cap       cap
    join      join
    f32       miter
    array f32 dash

class fill of layer

# cant inherently scroll in any element that doesnt have a defined children region
class children of layer
    vec2f scroll

class element
    element       parent
    region        area
    object        value
    string        id
    i64           flags
    layer[...]    layers
    map           elements
    array         tags
    string        group
    i32           tab_index
    bool          ghost
    bool          captured
    bool          selectable
    bool          selected
    bool          disabled
    bool          hovered
    bool          pressed
    bool          focused
    subs          action
    subs          wheel
    subs          context
    subs          text
    subs          hover
    subs          leave
    subs          key_down
    subs          key_up
    subs          press
    subs          move
    subs          release
    subs          got_capture
    subs          lost_capture
    subs          focus
    subs          blur
    vec2f         cursor
    intern composer    ux
    intern map         style_avail
    intern map         selections
    intern map         transitions
    intern bool        restyle
    none set_capture[]
    none release_capture[]
    none set_focus[]
    none release_focus[]
    none draw[window]
    map render[array]
    compare[element]

element scene
    target            target
    array             models
    f32               render_scale
    vec4f             clear_color
    array rotation    rotate
    array translation translate
    array scaling     scale
    subs              update
    none draw[window]
    none init[]
    none dealloc[]

scene stage
    bool frost
    none init[]
    none dealloc[]
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6

element pane

element button

<<<<<<< HEAD
class uniforms
    public t : trinity
    expect s : shader
    public u_memory : array
    public u_buffers : array
    public func update [ ] -> none
    func init [ ]

class shader
    public t               : trinity
    public name : string
    public vert : string
    public frag : string
    public comp : string
    public reloads : i32
    intern vk_vert : VkShaderModule
    intern vk_frag : VkShaderModule
    intern vk_comp : VkShaderModule
    public func reload [ ARef ] -> bool
    func init [ ]
    func dealloc [ ]

shader Basic
    public proj : mat4f
    public model : mat4f
    public view : mat4f
    attrib Surface [ color ] : 1, rgbaf


class IBL
    public placeholder : i32


/// attribute is a type, and a value; name is baked into enumeration
# lets made class names first class citizens in the syntax of inheritence; that way our [args] may be meta-members only
shader PBR
    public pos      : vec4f
    public dir      : vec4f
    public model    : mat4f
    public view     : mat4f
    public proj     : mat4f
    attrib Surface [ color ]    : 1, rgba8
    attrib Surface [ normal ]   : 1, rgba8
    attrib Surface [ emission ] : 1, rgbaf
    attrib Surface [ rough ]    : 1, u8
    attrib Surface [ metal ]    : 1, u8
    attrib Surface [ height ]   : 1, f32
    attrib Surface [ ao ]       : 1, u8
    attrib Surface [ ior ]      : 1, f32
    attrib Surface [ environment ] : 1, rgbaf, IBL
    func init [ ]


shader Env
    public view : mat4f
    public proj : mat4f
    public roughness_samples : vec2f
    attrib Surface [ color ] : 1, rgbaf
    func init [ ]

shader Convolve
    public env : mat4f
    public view : mat4f
    public proj : mat4f
    public roughness_samples : vec2f
    attrib Surface [ environment ] : 1, rgbaf

class buffer
    public t                : trinity
    expect size             : i64
    public data             : ARef
    public u_src            : bool
    public u_dst            : bool
    public u_shader         : bool
    public u_uniform        : bool
    public u_vertex         : bool
    public u_index          : bool
    public u_storage        : bool
    public m_device_local   : bool
    public m_host_visible   : bool
    public m_host_coherent  : bool
    intern user             : ARef
    intern vma_alloc        : VmaAllocation
    intern vk_buffer        : VkBuffer
    public func update        [ ARef ] -> none
    public func transfer      [ object ] -> none
    public func mmap          [ ] -> ARef
    public func unmap         [ ] -> none
    func init        [ ]
    func dealloc     [ ]
declare_class(buffer)


shader BlurV
    public model : mat4f
    public view : mat4f
    public proj : mat4f
    public reduction_scale : f32
    attrib Surface [ color ] : 1, rgba8


shader Blur
    public model : mat4f
    public view : mat4f
    public proj : mat4f
    public reduction_scale : f32
    attrib Surface [ color ] : 1, rgba8


shader UVQuad
    public model : mat4f
    public view : mat4f
    public proj : mat4f
    attrib Surface [ color ] : 1, rgba8
    func init [ ]


shader UVReduce
    public model    : mat4f
    public view     : mat4f
    public proj     : mat4f
    attrib Surface [ color ] : 1, rgba8
    func init [ ]


enum UXSurface
    background  : 0
    frost       : 1
    blur        : 2
    compose     : 3
    colorize    : 4
    overlay     : 5
    glyph       : 6


shader UXCompose
    public model        : mat4f
    public view         : mat4f
    public proj         : mat4f
    public low_color    : vec4f
    public high_color   : vec4f
    attrib UXSurface [ background ] : 1, rgba8
    attrib UXSurface [ frost ]      : 1, rgba8
    attrib UXSurface [ blur ]       : 1, rgba8
    attrib UXSurface [ compose ]    : 1, rgba8
    attrib UXSurface [ colorize ]   : 1, rgba8
    attrib UXSurface [ overlay ]    : 1, rgba8
    attrib UXSurface [ glyph ]      : 1, rgba8
    func init [ ]


shader UXSimple
    public model : mat4f
    public view  : mat4f
    public proj  : mat4f
    attrib UXSurface [ background ] : 1, rgba8
    attrib UXSurface [ colorize ]   : 1, rgba8
    attrib UXSurface [ overlay ]    : 1, rgba8
    attrib UXSurface [ glyph ]      : 1, rgba8
    func init [ ]


/// when created with a mere window reference, it will create a texture the size of the window
/// the last render in list will draw to swap-image; trinity works simply
/// everything renders to texture (target == texture) or the swap (target == window)
class target
    public t               : trinity
    public w               : window
    public id               : i32
    public wscale           : f32
    public width            : i32
    public height           : i32
    public reduce           : bool
    public models           : array
    public clear_color      : vec4f
    public reduction        : texture
    public color            : texture
    public depth            : texture
    intern reduce_model     : model
    intern vk_command_buffer                : VkCommandBuffer
    intern vk_swap_image                    : VkImage
    intern vk_fence                         : VkFence
    intern vk_semaphore                     : VkSemaphore
    intern vk_image_available_semaphore     : VkSemaphore
    intern vk_render_finished_semaphore     : VkSemaphore
    intern vk_framebuffer                   : array VkFramebuffer [ 2 ]
    intern vk_render_pass                   : array VkRenderPass  [ 2 ]
    intern last_width : i32
    intern last_height : i32
    public func update [ ] -> none
    public func draw [ ] -> none
    public func sync_fence [ ] -> none
    func init [ ]
    func dealloc [ ]

class app
    public w : window
    public ux : composer
    public t : trinity
    public app_context : ctx
    public ason_path : path
    public ason_render : map
    intern ason_modified : i64
    public style : style
    intern arg : object
    public on_render : callback
    public func initialize [ window ] -> none
    public func run [ ] -> i32
    func init [ ]
    func dealloc [ ]


class window
    intern window               : handle
    expect width                : u32
    expect height               : u32
    public t                    : trinity
    public mouse                : vec2f
    public ux                   : composer
    public element_targets      : map
    public list                 : array
    intern swap_renders         : array
    intern swap_model           : model
    intern vk_swap_images       : ref VkImage
    intern surface              : VkSurfaceKHR
    intern swapchain            : VkSwapchainKHR
    intern swap_targets         : array
    intern surface_caps         : ref VkSurfaceCapabilitiesKHR
    intern surface_format       : VkSurfaceFormatKHR
    intern present_mode         : VkPresentModeKHR
    intern extent               : VkExtent2D
    intern swap_render_current  : target
    intern semaphore_frame      : target
    intern swap_image_count     : u32
    intern swap_image_current   : u32
    intern ev                   : event
    public app_object           : app
    public compose              : sk
    public colorize             : sk
    public overlay              : sk
    public glyph                : sk
    public format               : Pixel
    public title                : string
    public debug_value          : f32
    public current_swap_index   : i32
    intern resized              : bool
    public backbuffer           : bool
    intern last_target          : target
    public m_reduce             : model
    public r_reduce             : target
    public m_reduce0            : model
    public r_reduce0            : target
    public m_reduce1            : model
    public r_reduce1            : target
    public m_reduce2            : model
    public r_reduce2            : target
    public m_reduce3            : model
    public r_reduce3            : target
    public m_blur_v             : model
    public r_blur_v             : target
    public m_blur               : model
    public r_blur               : target
    public m_frost_v            : model
    public r_frost_v            : target
    public m_frost              : model
    public r_frost              : target
    public m_view               : model
    public r_view               : target
    public func update_canvas [ ] -> none
    public func resize        [ i32  i32 ] -> none
    public func final_target  [ ] -> target
    public func draw          [ ] -> none
    public func draw_element  [ element ] -> none
    public cast image
    func init [ ]
    func dealloc [ ]

class SVG
    public w        : f32
    public h        : f32
    public rw       : f32
    public rh       : f32
    public svg_dom  : handle
    func dealloc[]

class draw_state
    public blur_radius          : f32
    public stroke_size          : f32
    public stroke_cap           : cap
    public stroke_join          : join
    public stroke_miter_limit   : f32
    public stroke_dash_offset   : f32
    public font                 : font
    public tx                   : texture
    public x                    : f32
    public y                    : f32
    public w                    : f32
    public h                    : f32
    public fill_color           : u32
    public stroke_color         : u32
    public opacity              : f32
    public func set_default [ ] -> none

image canvas
    expect t     : trinity
    public tx    : texture
    public state : array draw_state
    interface func save            [ ] -> none
    interface func restore         [ ] -> none
    interface func move_to         [ f32  f32 ] -> none
    interface func line_to         [ f32  f32 ] -> none
    interface func arc_to          [ f32, f32, f32, f32, f32 ] -> none
    interface func arc             [ f32, f32, f32, f32, f32 ] -> none
    interface func rect_to         [ f32 f32 f32 f32 ] -> none
    interface func rounded_rect_to [ f32, f32, f32, f32, f32, f32 ] -> none
    interface func fill_color      [ object ] -> none
    interface func stroke_color    [ object ] -> none
    interface func clear           [ object ] -> none
    interface func set_stroke      [ stroke ] -> none
    interface func set_font        [ font ] -> none
    interface func cubic           [ f32, f32, f32, f32, f32, f32 ] -> none
    interface func quadratic       [ f32 f32 f32 f32 ] -> none
    interface func draw_fill       [ ] -> none
    interface func draw_stroke     [ ] -> none
    interface func draw_fill_preserve [ ] -> none
    interface func draw_stroke_preserve [ ] -> none
    interface func blur_radius [ f32 ] -> none
    interface func prepare [ ] -> none
    interface func set_texture [ texture ] -> none
    interface func translate [ f32  f32 ] -> none
    interface func scale [ f32 ] -> none
    interface func clip [ rect f32 f32 ] -> none
    interface func stroke_size [ f32 ] -> none
    interface func stroke_cap [ cap ] -> none
    interface func stroke_join [ join ] -> none
    interface func stroke_miter_limit [ f32 ] -> none
    interface func stroke_dash_offset [ f32 ] -> none
    resize[]

struct text_metrics
    w : f32
    h : f32
    ascent      : f32
    descent     : f32
    line_height : f32
    cap_height  : f32

# our intern members need not have to resolve to users; we figure out the size once

canvas sk
    intern sk_context : ARef
    intern sk_surface : ARef
    intern sk_canvas : ARef
    intern sk_path : ARef
    intern once         : bool
    intern skia         : ref Skia
    intern vk_layout    : VkImageLayout
    public func save            [ ] -> none
    public func restore         [ ] -> none
    public func draw_svg        [ SVG rect vec2f vec2f ] -> none
    public func draw_image      [ image rect vec2f vec2f ] -> none
    public func measure         [ string ] -> text_metrics
    public func draw_text       [ string, rect, vec2f, vec2f, bool ] -> rect
    public func move_to         [ f32  f32 ]                -> none
    public func line_to         [ f32  f32 ]                -> none
    public func arc_to          [ f32, f32, f32, f32, f32 ] -> none
    public func arc             [ f32, f32, f32, f32, f32 ] -> none
    public func rect_to         [ f32 f32 f32 f32 ]         -> none
    public func rounded_rect_to [ f32, f32, f32, f32, f32, f32 ] -> none
    public func fill_color      [ object ] -> none
    public func clear           [ object ] -> none
    public func set_font        [ font ]   -> none
    public func cubic           [ f32, f32, f32, f32, f32, f32 ] -> none
    public func quadratic       [ f32 f32 f32 f32 ] -> none
    public func draw_fill       [ ] -> none
    public func draw_stroke     [ ] -> none
    public func draw_fill_preserve   [ ] -> none
    public func draw_stroke_preserve [ ] -> none
    public func blur_radius [ f32 ] -> none
    public func prepare [ ] -> none
    public func translate [ f32  f32 ] -> none
    public func scale [ f32 ] -> none
    public func clip [ rect f32 f32 ] -> none
    public func set_texture [ texture ] -> none
    public func stroke_color [ object ] -> none
    public func stroke_size [ f32 ] -> none
    public func stroke_cap [ cap ] -> none
    public func stroke_join [ join ] -> none
    public func stroke_miter_limit [ f32 ] -> none
    public func stroke_dash_offset [ f32 ] -> none
    public func opacity [ f32 ] -> none
    public func ellipsis [ string rect ARef ] -> string
    static func sync [ ] -> none
    func resize  [ i32 i32 ]
    func init    [ ]
    func dealloc [ ]
declare_class_3(sk, canvas, image)

none sk_sync_all();

class command
    public t : trinity
    intern vk : VkCommandBuffer
    public func begin [ ] -> none
    public func submit [ ] -> none
    func init [ ]
    func dealloc [ ]


class texture
    expect t : trinity
    public w : window
    public format           : Pixel
    public sampler          : object
    public width            : i32
    public height           : i32
    public swap             : bool
    public mip_levels       : i32
    public layer_count      : i32
    public surface          : Surface
    public linear           : bool
    intern vk_layout        : VkImageLayout   
    intern vk_format        : VkFormat        
    intern vk_image         : VkImage         
    intern vk_image_view    : VkImageView     
    intern vk_sampler       : VkSampler       
    intern vma_alloc        : VmaAllocation   
    public func resize        [ i32  i32 ] -> none
    public func transition    [ i32 ] -> none
    public cast image
    func init        [ ]
    func dealloc     [ ]
=======

class uniforms
    trinity       t
    required shader s
    array         u_memory
    array         u_buffers
    none update[]
    none init[]


class shader
    trinity        t
    string         name
    string         vert
    string         frag
    string         comp
    i32            reloads
    intern VkShaderModule vk_vert
    intern VkShaderModule vk_frag
    intern VkShaderModule vk_comp
    bool reload[ARef]
    none init[]
    none dealloc[]


class Basic of shader
    mat4f proj
    mat4f model
    mat4f view
    attrib Surface.color : rgbaf


class IBL
    i32 placeholder


# attribute is a type, and a value; name is baked into enumeration
# lets made class names first class citizens in the syntax of inheritence; that way our [args] may be meta-members only
class PBR of shader
    vec4f pos
    vec4f dir
    mat4f model
    mat4f view
    mat4f proj
    attrib Surface.color       rgba8
    attrib Surface.normal      rgba8
    attrib Surface.emission    rgbaf
    attrib Surface.rough       u8
    attrib Surface.metal       u8
    attrib Surface.height      f32
    attrib Surface.ao          u8
    attrib Surface.ior         f32
    attrib Surface.environment rgbaf, IBL
    none init[]


class Env of shader
    mat4f view
    mat4f proj
    vec2f roughness_samples
    attrib Surface [color] : 1, rgbaf
    none init[]


class Convolve of shader
    mat4f env
    mat4f view
    mat4f proj
    vec2f roughness_samples
    attrib Surface [environment] : 1, rgbaf


class buffer
    trinity       t
    required i64  size
    ARef          data
    bool          u_src
    bool          u_dst
    bool          u_shader
    bool          u_uniform
    bool          u_vertex
    bool          u_index
    bool          u_storage
    bool          m_device_local
    bool          m_host_visible
    bool          m_host_coherent
    intern ARef          user
    intern VmaAllocation vma_alloc
    intern VkBuffer      vk_buffer
    none update[ARef]
    none transfer[object]
    ARef mmap[]
    none unmap[]
    none init[]
    none dealloc[]


class BlurV of shader
    mat4f model
    mat4f view
    mat4f proj
    f32   reduction_scale
    attrib Surface [color] : 1, rgba8


class Blur of shader
    mat4f model
    mat4f view
    mat4f proj
    f32   reduction_scale
    attrib Surface [color] : 1, rgba8


class UVQuad of shader
    mat4f model
    mat4f view
    mat4f proj
    attrib Surface [color] : 1, rgba8
    none init[]


class UVReduce of shader
    mat4f model
    mat4f view
    mat4f proj
    attrib Surface [color] : 1, rgba8
    none init[]


enum UXSurface
    background : 0
    frost      : 1
    blur       : 2
    compose    : 3
    colorize   : 4
    overlay    : 5
    glyph      : 6


class UXCompose of shader
    mat4f model
    mat4f view
    mat4f proj
    vec4f low_color
    vec4f high_color
    attrib UXSurface.background : rgba8
    attrib UXSurface.frost      : rgba8
    attrib UXSurface.blur       : rgba8
    attrib UXSurface.compose    : rgba8
    attrib UXSurface.colorize   : rgba8
    attrib UXSurface.overlay    : rgba8
    attrib UXSurface.glyph      : rgba8
    none init[]


class UXSimple of shader
    mat4f model
    mat4f view
    mat4f proj
    attrib UXSurface.background : rgba8
    attrib UXSurface.colorize   : rgba8
    attrib UXSurface.overlay    : rgba8
    attrib UXSurface.glyph      : rgba8
    none init[]


# when created with a mere window reference, it will create a texture the size of the window
# the last render in list will draw to swap-image; trinity works simply
# everything renders to texture (target == texture) or the swap (target == window)
class target
    trinity       t
    window        w
    i32           id
    f32           wscale
    i32           width
    i32           height
    bool          reduce
    array         models
    vec4f         clear_color
    texture       reduction
    texture       color
    texture       depth
    intern model         reduce_model
    intern VkCommandBuffer vk_command_buffer
    intern VkImage         vk_swap_image
    intern VkFence         vk_fence
    intern VkSemaphore     vk_semaphore
    intern VkSemaphore     vk_image_available_semaphore
    intern VkSemaphore     vk_render_finished_semaphore
    intern array VkFramebuffer [2] vk_framebuffer
    intern array VkRenderPass  [2] vk_render_pass
    intern i32 last_width
    intern i32 last_height
    none update[]
    none draw[]
    none sync_fence[]
    none init[]
    none dealloc[]


class ux
    window      w
    composer    ux
    trinity     t
    ctx         app_context
    path        ason_path
    map         ason_render
    intern i64  ason_modified
    style       style
    intern object arg
    callback    on_render
    none initialize[window]
    i32  run[]
    none init[]
    none dealloc[]


class window
    intern handle window
    required u32    width
    required u32    height
    trinity t
    vec2f         mouse
    composer      ux
    map           element_targets
    array         list
    intern array         swap_renders
    intern model         swap_model
    intern ref VkImage   vk_swap_images
    intern VkSurfaceKHR  surface
    intern VkSwapchainKHR swapchain
    intern array         swap_targets
    intern ref VkSurfaceCapabilitiesKHR surface_caps
    intern VkSurfaceFormatKHR surface_format
    intern VkPresentModeKHR   present_mode
    intern VkExtent2D    extent
    intern target        swap_render_current
    intern target        semaphore_frame
    intern u32           swap_image_count
    intern u32           swap_image_current
    intern event         ev
    app           app_object
    sk            compose
    sk            colorize
    sk            overlay
    sk            glyph
    Pixel         format
    string        title
    f32           debug_value
    i32           current_swap_index
    intern bool   resized
    bool          backbuffer
    intern target last_target
    model         m_reduce
    target        r_reduce
    model         m_reduce0
    target        r_reduce0
    model         m_reduce1
    target        r_reduce1
    model         m_reduce2
    target        r_reduce2
    model         m_reduce3
    target        r_reduce3
    model         m_blur_v
    target        r_blur_v
    model         m_blur
    target        r_blur
    model         m_frost_v
    target        r_frost_v
    model         m_frost
    target        r_frost
    model         m_view
    target        r_view
    none update_canvas[]
    none resize[i32, i32]
    target final_target[]
    none draw[]
    none draw_element[element]
    cast image
    none init[]
    none dealloc[]


class SVG
    f32    w
    f32    h
    f32    rw
    f32    rh
    handle svg_dom
    none dealloc[]


class draw_state
    f32     blur_radius
    f32     stroke_size
    cap     stroke_cap
    join    stroke_join
    f32     stroke_miter_limit
    f32     stroke_dash_offset
    font    font
    texture tx
    f32     x
    f32     y
    f32     w
    f32     h
    u32     fill_color
    u32     stroke_color
    f32     opacity
    none set_default[]


class canvas of image
    required     trinity t
    texture      tx
    draw_state[] state
    none save[]
    none restore[]
    none move_to[f32, f32]
    none line_to[f32, f32]
    none arc_to[f32, f32, f32, f32, f32]
    none arc[f32, f32, f32, f32, f32]
    none rect_to[f32, f32, f32, f32]
    none rounded_rect_to[f32, f32, f32, f32, f32, f32]
    none fill_color[object]
    none stroke_color[object]
    none clear[object]
    none set_stroke[stroke]
    none set_font[font]
    none cubic[f32, f32, f32, f32, f32, f32]
    none quadratic[f32, f32, f32, f32]
    none draw_fill[]
    none draw_stroke[]
    none draw_fill_preserve[]
    none draw_stroke_preserve[]
    none blur_radius[f32]
    none prepare[]
    none set_texture[texture]
    none translate[f32, f32]
    none scale[f32]
    none clip[rect, f32, f32]
    none stroke_size[f32]
    none stroke_cap[cap]
    none stroke_join[join]
    none stroke_miter_limit[f32]
    none stroke_dash_offset[f32]
    resize[]


struct text_metrics
    f32 w
    f32 h
    f32 ascent
    f32 descent
    f32 line_height
    f32 cap_height


# our intern members need not have to resolve to users; we figure out the size once
class sk of canvas
    intern ARef         sk_context
    intern ARef         sk_surface
    intern ARef         sk_canvas
    intern ARef         sk_path
    intern bool         once
    intern ref Skia     skia
    intern VkImageLayout vk_layout
    none save[]
    none restore[]
    none draw_svg[SVG, rect, vec2f, vec2f]
    none draw_image[image, rect, vec2f, vec2f]
    text_metrics measure[string]
    rect draw_text[string, rect, vec2f, vec2f, bool]
    none move_to[f32 x, f32 y]
    none line_to[f32 x, f32 y]
    none arc_to[f32, f32, f32, f32, f32]
    none arc[f32, f32, f32, f32, f32]
    none rect_to[f32, f32, f32, f32]
    none rounded_rect_to[f32, f32, f32, f32, f32, f32]
    none fill_color[object]
    none clear[object]
    none set_font[font]
    none cubic[f32, f32, f32, f32, f32, f32]
    none quadratic[f32, f32, f32, f32]
    none draw_fill[]
    none draw_stroke[]
    none draw_fill_preserve[]
    none draw_stroke_preserve[]
    none blur_radius[f32]
    none prepare[]
    none translate[f32, f32]
    none scale[f32]
    none clip[rect, f32, f32]
    none set_texture[texture]
    none stroke_color[object]
    none stroke_size[f32]
    none stroke_cap[cap]
    none stroke_join[join]
    none stroke_miter_limit[f32]
    none stroke_dash_offset[f32]
    none opacity[f32]
    string ellipsis[string, rect, ARef]
    static none sync[]
    none resize[i32, i32]
    none init[]
    none dealloc[]


none sk_sync_all[]


class command
    trinity t
    intern VkCommandBuffer vk
    none begin[]
    none submit[]
    none init[]
    none dealloc[]


class texture
    required trinity t
    window        w
    Pixel         format
    object        sampler
    i32           width
    i32           height
    bool          swap
    i32           mip_levels
    i32           layer_count
    Surface       surface
    bool          linear
    intern VkImageLayout   vk_layout
    intern VkFormat        vk_format
    intern VkImage         vk_image
    intern VkImageView     vk_image_view
    intern VkSampler       vk_sampler
    intern VmaAllocation   vma_alloc
    none resize[i32, i32]
    none transition[i32]
    cast image
    none init[]
    none dealloc[]
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6

enum shader_local
    _undefined : 0

struct vertex_member_t
<<<<<<< HEAD
    type    : Au_t
    ac      : Accessor
    size    : i64
    offset  : i64

class gpu
    public t             : trinity
    expect name          : cstr
    public sampler       : image
    intern tx            : texture
    public vertex_data   : object
    public index_data    : object
    public members       : ref vertex_member_t
    public member_count  : i32
    public index_size    : i32
    public index_count   : i32
    public vertex_size   : i32
    public vertex_count  : i32
    intern vertex        : buffer
    intern index         : buffer
    intern vk_image      : VkImage
    intern vk_image_view : VkImageView
    intern vk_sampler    : VkSampler
    intern vma_alloc     : VmaAllocation
    public compute       : bool
    public   func sync    [ window ] -> none
    func init    [ ]
    func dealloc [ ]


class pipeline
    expect t                : trinity
    public w                : window
    expect r                : target
    expect s                : shader
    expect name             : string
    public render_id        : i32
    public default_model    : mat4f
    public shader_reloads   : i32
    public material         : Material
    public samplers         : map
    intern resources        : array
    intern shader_uniforms  : uniforms
    intern vbo              : gpu
    intern memory           : gpu
    intern descriptor_layouts : new VkDescriptorSetLayout [ 2 ] # this works better than doing trickery with the [ inner syntax; and MORE readable ]
    intern descriptor_sets    : new VkDescriptorSet       [ 2 ]
    intern descriptor_pool    : VkDescriptorPool
    intern bind               : VkDescriptorSet
    intern vk_render          : VkPipeline
    intern vk_compute         : VkPipeline
    intern layout             : VkPipelineLayout
    public   func rebind         [ ] -> none
    public   func draw           [ handle ] -> none
    public   func bind_resources [ ] -> none
    public   func reassemble     [ ] -> none
    func init           [ ]
    func dealloc        [ ]

class gltf_part
    expect id : Primitive
    public s  : shader

class gltf_node
    public id    : Node
    public parts : array gltf_part [] # we should have a 'container-size' defined on members in A-type; so they may initialize to this

// #define node_default null

class model
    public t                : trinity
    public w                : window
    public r                : target
    intern transforms       : ref mat4f
    intern transform_count  : i32
    public id               : Model
    public nodes            : array
    public s                : shader
    public samplers         : map
    intern pipelines        : array
    public func rebind_model  [ ] -> none
    public func finish        [ target, i32 ] -> none
    func init        [ ]
    func dealloc     [ ]

class particle
    public pos      : vec2f
    public velocity : vec2f
    public density  : f32
    public pressure : f32

// user init lets the developer control when the init calls, so they may set properties for mounted components in a tree
// this, without introducing a 'mount' call in addition to init; which is an anti pattern
// #define define_element(A0, A1, ...) \
//    define_any(A0, A1, sizeof(struct _##A0), AU_TRAIT_USER_INIT, __VA_ARGS__)


#endif
=======
    Au_t     type
    Accessor ac
    i64      size
    i64      offset

class gpu
    required trinity t
    required cstr    name
    image         sampler
    intern texture tx
    object        vertex_data
    object        index_data
    ref vertex_member_t members
    i32           member_count
    i32           index_size
    i32           index_count
    i32           vertex_size
    i32           vertex_count
    intern buffer vertex
    intern buffer index
    intern VkImage     vk_image
    intern VkImageView vk_image_view
    intern VkSampler   vk_sampler
    intern VmaAllocation vma_alloc
    bool          compute
    none sync[window]
    none init[]
    none dealloc[]


class pipeline
    required trinity t
    public   window  w
    required target  r
    required shader  s
    required string  name
    i32           render_id
    mat4f         default_model
    i32           shader_reloads
    Material      material
    map           samplers
    intern array  resources
    intern uniforms shader_uniforms
    intern gpu    vbo
    intern gpu    memory
    intern VkDescriptorSetLayout[2] descriptor_layouts
    intern VkDescriptorSet      [2] descriptor_sets
    intern VkDescriptorPool descriptor_pool
    intern VkDescriptorSet  bind
    intern VkPipeline       vk_render
    intern VkPipeline       vk_compute
    intern VkPipelineLayout layout
    none rebind[]
    none draw[handle]
    none bind_resources[]
    none reassemble[]
    none init[]
    none dealloc[]


class gltf_part
    required Primitive id
    shader s


class gltf_node
    Node            id
    array gltf_part parts


class model
    trinity t
    window  w
    target  r
    intern ref mat4f transforms
    intern i32       transform_count
    Model         id
    array         nodes
    shader        s
    map           samplers
    intern array  pipelines
    none rebind_model[]
    none finish[target, i32]
    none init[]
    none dealloc[]


class particle
    vec2f pos
    vec2f velocity
    f32   density
    f32   pressure
>>>>>>> 50c4e66a8fd6276bd48d5055d9c621c5b720b0c6
